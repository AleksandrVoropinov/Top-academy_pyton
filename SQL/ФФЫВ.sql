CREATE TABLE BOOKINGS
(
	BOOK_REF CHAR(6) NOT NULL UNIQUE,
	BOOK_DATE DATE NOT NULL,
	TOTAL_AMOUNT REAL NOT NULL,
	PRIMARY KEY(BOOK_REF)
);

CREATE TABLE TICKETS
(
	TICKET_NO CHAR(13) NOT NULL UNIQUE,
	BOOK_REF CHAR(6) NOT NULL,
	PASSENGER_ID TEXT NOT NULL,
	PASSENGER_NAME TEXT NOT NULL,
	CONTACT_DATA TEXT,
	PRIMARY KEY(TICKET_NO),
	FOREIGN KEY(BOOK_REF) REFERENCES BOOKINGS (BOOK_REF)
);

CREATE TABLE AIRPORTS
(
	AIRPORT_CODE CHAR(3) NOT NULL UNIQUE,
	AIRPORT_NAME TEXT NOT NULL,
	CITY TEXT NOT NULL,
	LONGITUDE REAL NOT NULL,
	LATITUDE REAL NOT NULL,
	TIMEZONE INTEGER CHECK(TIMEZONE >= -12 OR TIMEZONE <= 12) NOT NULL,
	PRIMARY KEY(AIRPORT_CODE)
);

CREATE TABLE AIRCRAFTS
(
	AIRCRAFT_CODE INT NOT NULL UNIQUE,
	MODEL TEXT NOT NULL,
	RANGE TEXT NOT NULL,
	PRIMARY KEY(AIRCRAFT_CODE)
);

CREATE TABLE SEATS
(
	AIRCRAFT_CODE INTEGER NOT NULL UNIQUE,
	SEAT_NO CHAR(3) NOT NULL UNIQUE,
	FARE_CONDITIONS TEXT NOT NULL,
	PRIMARY KEY(AIRCRAFT_CODE, SEAT_NO)
);

CREATE TABLE FLIGHTS
(
	FLIGHT_ID SERIAL,
	FLIGHT_NO INTEGER NOT NULL,
	SCHEDULED_DEPARTURE TIMESTAMP NOT NULL,
	SCHEDULED_ARRIVAL TIMESTAMP NOT NULL,
	DEPARTURE_AIRPORT CHAR(3) NOT NULL,
	ARRIVAL_AIRPORT CHAR(3) NOT NULL,
	STATUS TEXT NOT NULL,
	AIRCRAFT_CODE INTEGER NOT NULL,
	ACTUAL_DEPARTURE TIMESTAMP,
	ACTUAL_ARRIVAL TIMESTAMP,
	PRIMARY KEY(FLIGHT_ID),
	FOREIGN KEY(AIRCRAFT_CODE) REFERENCES AIRCRAFTS (AIRCRAFT_CODE),
	FOREIGN KEY(DEPARTURE_AIRPORT) REFERENCES AIRPORTS (AIRPORT_CODE),
	FOREIGN KEY(ARRIVAL_AIRPORT) REFERENCES AIRPORTS (AIRPORT_CODE)
);

CREATE TABLE TICKET_FLIGHTS
(
	TICKET_NO CHAR(13) NOT NULL,
	FLIGHT_ID SERIAL,
	FARE_CONDITIONS TEXT NOT NULL,
	AMOUNT REAL NOT NULL,
	PRIMARY KEY(TICKET_NO, FLIGHT_ID),
	FOREIGN KEY(TICKET_NO) REFERENCES TICKETS (TICKET_NO),
	FOREIGN KEY(FLIGHT_ID) REFERENCES FLIGHTS (FLIGHT_ID)
);

CREATE TABLE BOARDING_PASSES
(
	TICKET_NO CHAR(13) NOT NULL,
	FLIGHT_ID SERIAL,
	BOARDING_NO CHAR(13) NOT NULL,
	SEAT_NO CHAR(3) NOT NULL,
	PRIMARY KEY(TICKET_NO, FLIGHT_ID),
	FOREIGN KEY(FLIGHT_ID, TICKET_NO) REFERENCES TICKET_FLIGHTS (FLIGHT_ID, TICKET_NO)
);

INSERT INTO BOOKINGS (BOOK_REF, BOOK_DATE, TOTAL_AMOUNT)
VALUES
('AK768D', '2023-03-14', 7890.2),
('BY543D', '2023-03-16', 5670.4);

INSERT INTO TICKETS (TICKET_NO, BOOK_REF, PASSENGER_ID, PASSENGER_NAME, CONTACT_DATA)
VALUES
('6574687654876', 'AK768D', '6215 765432', 'ARINA ZHELTYAKOVA', '89064533456'),
('9482846095342', 'BY543D', '6524 765456', 'DANIL ZHELTYAKOV', '89002001417');

INSERT INTO AIRPORTS (AIRPORT_CODE, AIRPORT_NAME, CITY, LONGITUDE, LATITUDE, TIMEZONE )
VALUES
('SVX', 'KOLTSOVO', 'EKATERINBURG', 56.740000000000, 60.800000000000, '5' ),
('LED', 'PULKOVO', 'SAINT-PETERSBURG', 59.939039000000, 30.315785000000, '3');

INSERT INTO AIRCRAFTS (AIRCRAFT_CODE, MODEL, RANGE)
VALUES
('73', 'Boeing 737-200 Freighter', '4,260 KM'),
('733', 'Boeing 737-300', '4,204 KM');

INSERT INTO SEATS (AIRCRAFT_CODE, SEAT_NO, FARE_CONDITIONS)
VALUES
('73', '2A', 'BUSINESS'),
('733', '20D', 'ECONOMY');

INSERT INTO FLIGHTS  (FLIGHT_NO, SCHEDULED_DEPARTURE, SCHEDULED_ARRIVAL, DEPARTURE_AIRPORT, ARRIVAL_AIRPORT, STATUS, AIRCRAFT_CODE, ACTUAL_DEPARTURE, ACTUAL_ARRIVAL)  
VALUES
('8930', '2023-03-16 05:23:10', '2023-03-16 10:23:10', 'LED', 'SVX', 'DEPARTED', '73', NULL, NULL),
('6543', '2023-03-14 10:00:23', '2023-03-14 13:00:00', 'SVX', 'LED', 'DELAYED', '733', '2023-03-14 11:00:23', '2023-03-14 14:00:00');

INSERT INTO TICKET_FLIGHTS (TICKET_NO, FLIGHT_ID, FARE_CONDITIONS, AMOUNT)
VALUES
('6574687654876', '1', 'BUSINESS', '7890.2'),
('9482846095342', '2', 'ECONOMY', '5670.4');

INSERT INTO BOARDING_PASSES (TICKET_NO, FLIGHT_ID, BOARDING_NO, SEAT_NO)
VALUES
('6574687654876', '1', '23', '2A'),
('9482846095342', '2', '13', '20D');